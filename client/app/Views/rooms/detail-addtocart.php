<div class="cr-sidebar-overlay"></div>
<div id="cr_mobile_menu" class="cr-side-cart cr-mobile-menu">
    <div class="cr-menu-title">
        <span class="menu-title">My Menu</span>
        <button type="button" class="cr-close">×</button>
    </div>
    <div class="cr-menu-inner">
        <div class="cr-menu-content">
            <ul>
                <li class="dropdown drop-list">
                    <a href="index.html">Home</a>
                </li>
                <li class="dropdown drop-list">
                    <span class="menu-toggle"></span>
                    <a href="javascript:void(0)" class="dropdown-list">Category</a>
                    <ul class="sub-menu">
                        <li><a href="shop-left-sidebar.html">Shop Left sidebar</a></li>
                        <li><a href="shop-right-sidebar.html">Shop Right sidebar</a></li>
                        <li><a href="shop-full-width.html">Full Width</a></li>
                    </ul>
                </li>
                <li class="dropdown drop-list">
                    <span class="menu-toggle"></span>
                    <a href="javascript:void(0)" class="dropdown-list">product</a>
                    <ul class="sub-menu">
                        <li><a href="product-left-sidebar.html">product Left sidebar</a></li>
                        <li><a href="product-right-sidebar.html">product Right sidebar</a></li>
                        <li><a href="product-full-width.html">Product Full Width </a></li>
                    </ul>
                </li>
                <li class="dropdown drop-list">
                    <span class="menu-toggle"></span>
                    <a href="javascript:void(0)" class="dropdown-list">Pages</a>
                    <ul class="sub-menu">
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact-us.html">Contact Us</a></li>
                        <li><a href="cart.html">Cart</a></li>
                        <li><a href="checkout.html">Checkout</a></li>
                        <li><a href="track-order.html">Track Order</a></li>
                        <li><a href="wishlist.html">Wishlist</a></li>
                        <li><a href="faq.html">Faq</a></li>
                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>
                        <li><a href="policy.html">Policy</a></li>
                    </ul>
                </li>
                <li class="dropdown drop-list">
                    <span class="menu-toggle"></span>
                    <a href="javascript:void(0)" class="dropdown-list">Blog</a>
                    <ul class="sub-menu">
                        <li><a href="blog-left-sidebar.html">Left Sidebar</a></li>
                        <li><a href="blog-right-sidebar.html">Right Sidebar</a></li>
                        <li><a href="blog-full-width.html">Full Width</a></li>
                        <li><a href="blog-detail-left-sidebar.html">Detail Left Sidebar</a></li>
                        <li><a href="blog-detail-right-sidebar.html">Detail Right Sidebar</a></li>
                        <li><a href="blog-detail-full-width.html">Detail Full Width</a></li>
                    </ul>
                </li>
                <li class="dropdown drop-list">
                    <span class="menu-toggle"></span>
                    <a href="javascript:void(0)">Element</a>
                    <ul class="sub-menu">
                        <li><a href="elements-products.html">Products</a></li>
                        <li><a href="elements-typography.html">Typography</a></li>
                        <li><a href="elements-buttons.html">Buttons</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Breadcrumb -->
<section class="section-breadcrumb">
    <div class="cr-breadcrumb-image">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="cr-breadcrumb-title">
                        <h2>Product</h2>
                        <span> <a href="index.html">Home</a> - product</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product -->
<section class="section-product padding-t-100">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-12 md-30" data-aos="fade-up" data-aos-duration="2000" data-aos-delay="400">

            </div>
        </div>


        <div class="col-lg-9 col-12 md-30" data-aos="fade-up" data-aos-duration="2000" data-aos-delay="600">
            <div class="row mb-minus-24">
                <div class="col-md-6 col-12 mb-24">
                    <div class="vehicle-detail-banner banner-content clearfix">
                        <div class="banner-slider">
                            <div class="slider slider-for">
                                <div class="slider-banner-image">
                                    <div class="zoom-image-hover">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-1"
                                            class="product-image">
                                    </div>
                                </div>
                            </div>
                            <div class="slider slider-nav thumb-image">
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-1">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-2">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-3">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-1">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-2">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-3">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-1">
                                    </div>
                                </div>
                                <div class="thumbnail-image">
                                    <div class="thumbImg">
                                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="product-tab-2">
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-12 mb-24">
                    <div class="cr-size-and-weight-contain">
                        <h2 class="heading"><?= $roomThis['name'] ?></h2>
                    </div>
                    <div class="cr-size-and-weight">
                        <div class="cr-review-star">
                            <div class="cr-star">
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                                <i class="ri-star-fill"></i>
                            </div>
                            <p>( 75 Review )</p>
                        </div>
                        <div class="list">
                        <ul>
                                <li><label>Brand <span>:</span></label>Aba Hotel</li>
                                <li><label>Location <span>:</span></label>City Center</li>
                                <li><label>Room Type <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['name'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?></li>
                                <li><label>Beds <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['number_of_beds'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?></li>
                                    <li><label>Occupancy <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['max_occupancy'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?></li>
                                <li><label>Amenities <span>:</span></label>Free Wi-Fi, Spa, Gym</li>
                                <li><label>Specialty <span>:</span></label>Top-notch Service, City Views</li>
                                <li><label>Info <span>:</span></label>24/7 Room Service, Airport Shuttle</li>
                                <li><label>Price <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['price'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?>$</li>
                            </ul>
                        </div>
                        <?php if ($roomThis['status'] === 'occupied'): ?>
                            <!-- Khi phòng đã được đặt -->
                            <div class="cr-add-card">
                                <div class="room-status-alert">
                                    <i class="ri-alert-line"></i>
                                    <span>Room is full!</span>
                                </div>
                            </div>
                        <?php else: ?>
                            <!-- Khi phòng còn trống -->
                            <div class="cr-add-card">
                                <!-- <div class="cr-qty-main">
                                    <input type="text" placeholder="." value="1" minlength="1" maxlength="20"
                                        class="quantity">
                                    <button type="button" id="add" class="plus">+</button>
                                    <button type="button" id="sub" class="minus">-</button>
                                </div> -->
                                <div class="cr-add-button">
                                    <button type="button" class="cr-button cr-shopping-bag">Add to cart</button>
                                </div>
                                <div class="cr-card-icon">
                                    <!-- <a href="javascript:void(0)" class="wishlist">
                                        <i class="ri-heart-line"></i>
                                    </a> -->
                                    <a class="model-oraganic-product" data-bs-toggle="modal" href="#quickview" role="button">
                                        <i class="ri-eye-line"></i>
                                    </a>
                                </div>
                            </div>
                        <?php endif; ?>

                        <!-- Add feedback form here -->
                        <div class="cr-feedback-section mt-4">


                            <?php if (isset($_SESSION['user-client'])): ?>

                            <?php else: ?>
                                <div class="alert alert-info">
                                    Please <a href="<?= BASE_URL ?>?act=login">login</a> to submit a review
                                </div>
                            <?php endif; ?>

                            <!-- Alert messages -->
                            <?php if (isset($_SESSION['error'])): ?>
                                <div class="alert alert-danger">
                                    <?= $_SESSION['error'] ?>
                                    <?php unset($_SESSION['error']); ?>
                                </div>
                            <?php endif; ?>

                            <?php if (isset($_SESSION['success'])): ?>
                                <div class="alert alert-success">
                                    <?= $_SESSION['success'] ?>
                                    <?php unset($_SESSION['success']); ?>
                                </div>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Hiển thị thông báo -->
            <?php if (isset($_SESSION['error'])): ?>
                <div class="alert alert-danger">
                    <?= $_SESSION['error'] ?>
                    <?php unset($_SESSION['error']); ?>
                </div>
            <?php endif; ?>

            <?php if (isset($_SESSION['success'])): ?>
                <div class="alert alert-success">
                    <?= $_SESSION['success'] ?>
                    <?php unset($_SESSION['success']); ?>
                </div>
            <?php endif; ?>

            <div class="cr-paking-delivery">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab"
                            data-bs-target="#description" type="button" role="tab" aria-controls="description"
                            aria-selected="true">Description</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="additional-tab" data-bs-toggle="tab"
                            data-bs-target="#additional" type="button" role="tab" aria-controls="additional"
                            aria-selected="false">Information</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="review-tab" data-bs-toggle="tab" data-bs-target="#review"
                            type="button" role="tab" aria-controls="review"
                            aria-selected="false">Review</button>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="description" role="tabpanel"
                        aria-labelledby="description-tab">
                        <div class="cr-tab-content">
                            <div class="cr-description">
                                <p>Aba Hotel is a sophisticated haven designed to redefine luxury and relaxation. With its
                                    prime location in the heart of the city, the hotel offers guests seamless access to vibrant
                                    attractions, business hubs, and cultural landmarks, ensuring an unforgettable experience for
                                    all who visit. Each stay at Aba Hotel is marked by exceptional service and attention to detail,
                                    creating a welcoming atmosphere that feels like a home away from home.</p>
                            </div>
                            <h4 class="heading">Packaging & Delivery</h4>
                            <div class="cr-description">
                                <p>Aba Hotel is a sophisticated haven designed to redefine luxury and relaxation. With its
                                    prime location in the heart of the city, the hotel offers guests seamless access to vibrant
                                    attractions, business hubs, and cultural landmarks, ensuring an unforgettable experience for
                                    all who visit. Each stay at Aba Hotel is marked by exceptional service and attention to detail,
                                    creating a welcoming atmosphere that feels like a home away from home.</p>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="additional" role="tabpanel" aria-labelledby="additional-tab">
                        <div class="cr-tab-content">
                            <div class="cr-description">
                                <p>Aba Hotel is a sophisticated haven designed to redefine luxury and relaxation. With its
                                    prime location in the heart of the city, the hotel offers guests seamless access to vibrant
                                    attractions, business hubs, and cultural landmarks, ensuring an unforgettable experience for
                                    all who visit. Each stay at Aba Hotel is marked by exceptional service and attention to detail,
                                    creating a welcoming atmosphere that feels like a home away from home.</p>
                            </div>
                            <div class="list">
                            <ul>
                                <li><label>Brand <span>:</span></label>Aba Hotel</li>
                                <li><label>Location <span>:</span></label>City Center</li>
                                <li><label>Room Type <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['name'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?></li>
                                <li><label>Beds <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['number_of_beds'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?></li>
                                    <li><label>Occupancy <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['max_occupancy'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?></li>
                                <li><label>Amenities <span>:</span></label>Free Wi-Fi, Spa, Gym</li>
                                <li><label>Specialty <span>:</span></label>Top-notch Service, City Views</li>
                                <li><label>Info <span>:</span></label>24/7 Room Service, Airport Shuttle</li>
                                <li><label>Price <span>:</span></label><?php foreach ($roomType as $room_type): ?>
                                        <?php if ($roomThis['id_room_type'] == $room_type['id']): ?>
                                            <?= $roomThis['id_room_type'] == $room_type['id'] ? $room_type['price'] : null ?>
                                        <?php endif; ?>
                                    <?php endforeach; ?>$</li>
                            </ul>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
                        <div class="cr-tab-content-from">
                            <div class="post">
                                <?php foreach ($feedbacks as $feedback): ?>
                                    <div class="content mt-30">

                                        <div class="details">


                                            <span class="name"><?= $feedback['user_name'] ?></span>
                                            <span class="date"><?= $feedback['created_at'] ?></span>

                                        </div>
                                        <div class="cr-t-review-rating">
                                            <?php
                                            $feedbackController = new FeedbackController();
                                            echo $feedbackController->displayStars($feedback['rating']);
                                            ?>
                                        </div>
                                    </div>
                                    <p> <span class="date"><?= $feedback['comment'] ?></span></p>
                                <?php endforeach; ?>

                            </div>

                            <h4 class="heading">Add a Review</h4>

                            <div class="cr-feedback-section mt-4">

                                <?php if (isset($_SESSION['user-client'])): ?>
                                    <form class="cr-content-form" method="POST" action="<?= BASE_URL . '?act=feedback' ?>">
                                        <!-- Hidden fields -->
                                        <input type="hidden" name="id_room" value="<?= $roomThis['id'] ?>">
                                        <input type="hidden" name="id_user" value="<?= $_SESSION['user-client']->id ?>">

                                        <!-- Rating stars -->
                                        <div class="cr-ratting-star mb-3">
                                            <span>Your rating:</span>
                                            <div class="rating">
                                                <input type="radio" name="rating" value="5" id="rating-5" required>
                                                <label for="rating-5"></label>
                                                <input type="radio" name="rating" value="4" id="rating-4">
                                                <label for="rating-4"></label>
                                                <input type="radio" name="rating" value="3" id="rating-3">
                                                <label for="rating-3"></label>
                                                <input type="radio" name="rating" value="2" id="rating-2">
                                                <label for="rating-2"></label>
                                                <input type="radio" name="rating" value="1" id="rating-1">
                                                <label for="rating-1"></label>
                                            </div>
                                        </div>

                                        <!-- Comment box -->
                                        <div class="cr-ratting-input">
                                            <textarea
                                                name="comment"
                                                class="form-control mb-3"
                                                placeholder="Enter your feedback here..."
                                                required></textarea>
                                            <button type="submit" class="cr-button" name="feedback" value="1">
                                                Send Review
                                            </button>
                                        </div>
                                    </form>
                                <?php else: ?>
                                    <div class="alert alert-info">
                                        Please <a href="<?= BASE_URL ?>?act=login">login</a> to submit a review
                                    </div>
                                <?php endif; ?>

                                <!-- Alert messages -->
                                <?php if (isset($_SESSION['error'])): ?>
                                    <div class="alert alert-danger">
                                        <?= $_SESSION['error'] ?>
                                        <?php unset($_SESSION['error']); ?>
                                    </div>
                                <?php endif; ?>

                                <?php if (isset($_SESSION['success'])): ?>
                                    <div class="alert alert-success">
                                        <?= $_SESSION['success'] ?>
                                        <?php unset($_SESSION['success']); ?>
                                    </div>
                                <?php endif; ?>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Hiển thị thông báo -->
                <?php if (isset($_SESSION['error'])): ?>
                    <div class="alert alert-danger">
                        <?= $_SESSION['error'] ?>
                        <?php unset($_SESSION['error']); ?>
                    </div>
                <?php endif; ?>

                <?php if (isset($_SESSION['success'])): ?>
                    <div class="alert alert-success">
                        <?= $_SESSION['success'] ?>
                        <?php unset($_SESSION['success']); ?>
                    </div>
                <?php endif; ?>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
</section>

<!-- Popular products -->
<section class="section-popular-products padding-tb-100" data-aos="fade-up" data-aos-duration="2000" data-aos-delay="400">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="mb-30">
                    <div class="cr-banner">
                        <h2>Popular Products</h2>
                    </div>
                    <div class="cr-banner-sub-title">
                        <p>Aba ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
                            ut labore et viverra maecenas accumsan lacus vel facilisis. </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="cr-popular-product">
                    <?php foreach ($rooms as $room): ?>

                        <div class="slick-slide">
                            <div class="cr-product-card">
                                <div class="cr-product-image">
                                    <div class="cr-image-inner zoom-image-hover">
                                        <img src="<?= BASE_URL . $room->r_image ?>" alt="product-1">
                                    </div>
                                    <!-- <div class="cr-side-view">
                                        <a href="javascript:void(0)" class="wishlist">
                                            <i class="ri-heart-line"></i>
                                        </a>
                                        <a class="model-oraganic-product" data-bs-toggle="modal" href="#quickview"
                                            role="button">
                                            <i class="ri-eye-line"></i>
                                        </a>
                                    </div> -->
                                    <a class="cr-shopping-bag" href="javascript:void(0)">
                                        <i class="ri-shopping-bag-line"></i>
                                    </a>
                                </div>
                                <div class="cr-product-details">
                                    <div class="cr-brand">
                                        <a href="shop-left-sidebar.html">Room</a>
                                        <div class="cr-star">
                                            <i class="ri-star-fill"></i>
                                            <i class="ri-star-fill"></i>
                                            <i class="ri-star-fill"></i>
                                            <i class="ri-star-fill"></i>
                                            <i class="ri-star-line"></i>
                                            <p>(4.5)</p>
                                        </div>
                                    </div>
                                    <a href="?act=room-detail&id=<?= $room->r_id ?> " class="title"><?= $room->r_name ?></a>
                                    <p class="cr-price"><span class="new-price"><?= $room->t_price ?>$</span>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>

                </div>
            </div>
        </div>
    </div>
</section>

<!-- Thêm modal popup vào cuối file, trước </section> -->
<div class="modal fade" id="quickview" tabindex="-1" aria-labelledby="quickviewLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickviewLabel"><?= $roomThis['name'] ?></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <img src="<?= BASE_URL . $roomThis['image'] ?>" alt="<?= $roomThis['name'] ?>" class="img-fluid">
                    </div>
                    <div class="col-md-6">
                        <div class="product-details">
                            <!-- Thêm form đặt phòng -->
                            <form action="<?= BASE_URL ?>?act=reservation" method="POST" class="booking-form mt-3">
                                <input type="hidden" name="room_id" value="<?= $roomThis['id'] ?>">

                                <div class="mb-3">
                                    <label for="checkin_date" class="form-label">Check-in Date:</label>
                                    <input type="date"
                                        class="form-control"
                                        id="checkin_date"
                                        name="checkin_date"
                                        min="<?= date('Y-m-d') ?>"
                                        required>
                                </div>

                                <div class="mb-3">
                                    <label for="checkout_date" class="form-label">Check-out Date:</label>
                                    <input type="date"
                                        class="form-control"
                                        id="checkout_date"
                                        name="checkout_date"
                                        min="<?= date('Y-m-d', strtotime('+1 day')) ?>"
                                        required>
                                </div>

                                <div class="mb-3">
                                    <label for="occupancy" class="form-label">Occupancy:</label>
                                    <?php
                                    // Debug để xem giá trị thực tế của id_room_type
                                    $maxOccupancy = 2; // Giá trị mặc định

                                    // Đổi sang sử dụng ID số thay vì text
                                    switch ($roomThis['id_room_type']) {
                                        case 2: // Suite
                                            $maxOccupancy = 1;
                                            break;
                                        case 3: // Standard
                                            $maxOccupancy = 4;
                                            break;
                                        case 1: // Deluxe
                                            $maxOccupancy = 8;
                                            break;
                                    }
                                    ?>
                                    <input type="number"
                                        class="form-control"
                                        id="occupancy"
                                        name="occupancy"
                                        min="1"
                                        max="<?= $maxOccupancy ?>"
                                        value="1"
                                        required>
                                    <small class="form-text text-muted">
                                        Maximum occupancy for 1 room: <?= $maxOccupancy ?> persons
                                    </small>
                                    <div id="occupancy-error" class="invalid-feedback">
                                        Number of guests cannot exceed <?= $maxOccupancy ?> persons for this room type.
                                    </div>
                                </div>
                                <!-- Thêm ngay trước total price -->
                                <div class="mb-3">
                                    <label class="form-label"><strong>Payment Method:</strong></label>
                                    <div class="payment-methods">
                                        <?php if (isset($currentReservation) && is_array($currentReservation)): ?>
                                            <?php foreach ($currentReservation as $method): ?>
                                                <div class="form-check">
                                                    <input class="form-check-input" 
                                                           type="radio" 
                                                           name="payment_method" 
                                                           id="<?= $method['payment_method'] ?>" 
                                                           value="<?= $method['payment_method'] ?>" 
                                                           required>
                                                    <label class="form-check-label" for="<?= $method['payment_method'] ?>">
                                                        <i class="<?= $method['payment_method'] === 'Bank Transfer' ? 'ri-bank-line' : 'ri-money-dollar-box-line' ?>"></i>
                                                        <?= $method['payment_method'] ?>
                                                    </label>
                                                </div>
                                            <?php endforeach; ?>
                                        <?php else: ?>
                                            <!-- Fallback options nếu không có dữ liệu -->
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="payment_method" id="bank_transfer" value="Bank Transfer" required>
                                                <label class="form-check-label" for="bank_transfer">
                                                    <i class="ri-bank-line"></i> Bank Transfer
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="payment_method" id="cash" value="Cash" required>
                                                <label class="form-check-label" for="cash">
                                                    <i class="ri-money-dollar-box-line"></i> Cash
                                                </label>
                                            </div>
                                        <?php endif; ?>
                                    </div>
                                </div>
                                <!-- Hiển thị giá cho người dùng xem -->
                                <div class="total-price mb-3">
                                    <strong>Total Price: </strong>
                                    <span id="calculated_price">$<?= number_format($currentRoomType->price, 0) ?></span>
                                </div>


                                <!-- Input hidden để gửi giá trị -->
                                <input type="hidden" name="total_price" id="total_price_input" value="<?= $currentRoomType->price ?>">

                                <button type="submit" class="btn btn-primary" name="booknow">Book Now</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Thêm JavaScript để xử lý tính toán giá và validate dates -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkinInput = document.getElementById('checkin_date');
        const checkoutInput = document.getElementById('checkout_date');
        const priceDisplay = document.getElementById('calculated_price');
        const totalPriceInput = document.getElementById('total_price_input');
        const basePrice = <?= $currentRoomType->price ?? 0 ?>;

        // Hàm tính số ngày giữa 2 ngày
        function calculateDays(checkin, checkout) {
            const start = new Date(checkin);
            const end = new Date(checkout);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Hàm tính tổng giá
        function updateTotalPrice() {
            const checkin = checkinInput.value;
            const checkout = checkoutInput.value;

            if (checkin && checkout) {
                const days = calculateDays(checkin, checkout);
                const total = basePrice * days;
                
                // Cập nhật hiển thị giá
                priceDisplay.textContent = `$${total.toFixed(0)}`;
                
                // Cập nhật giá trị trong input hidden
                totalPriceInput.value = total;
            } else {
                // Nếu chưa chọn ngày, hiển thị giá gốc
                priceDisplay.textContent = `$${basePrice.toFixed(0)}`;
                totalPriceInput.value = basePrice;
            }
        }

        // Event listeners
        checkinInput.addEventListener('change', function() {
            // Set minimum checkout date to day after checkin
            const minCheckout = new Date(this.value);
            minCheckout.setDate(minCheckout.getDate() + 1);
            checkoutInput.min = minCheckout.toISOString().split('T')[0];

            // Clear checkout if it's before new minimum
            if (checkoutInput.value && new Date(checkoutInput.value) <= new Date(this.value)) {
                checkoutInput.value = '';
            }

            updateTotalPrice();
        });

        checkoutInput.addEventListener('change', updateTotalPrice);
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const occupancyInput = document.getElementById('occupancy');
        const maxOccupancy = <?= $maxOccupancy ?>;
        const errorDiv = document.getElementById('occupancy-error');
        const bookButton = document.querySelector('button[type="submit"]');

        // Validate occupancy when input changes
        occupancyInput.addEventListener('input', function() {
            const value = parseInt(this.value);

            if (value > maxOccupancy) {
                occupancyInput.classList.add('is-invalid');
                errorDiv.style.display = 'block';
                bookButton.disabled = true;
            } else if (value < 1) {
                occupancyInput.classList.add('is-invalid');
                errorDiv.textContent = 'Minimum occupancy is 1 person';
                errorDiv.style.display = 'block';
                bookButton.disabled = true;
            } else {
                occupancyInput.classList.remove('is-invalid');
                errorDiv.style.display = 'none';
                bookButton.disabled = false;
            }
        });

        // Prevent form submission if occupancy is invalid
        document.querySelector('form').addEventListener('submit', function(e) {
            const value = parseInt(occupancyInput.value);
            if (value > maxOccupancy || value < 1) {
                e.preventDefault();
                occupancyInput.classList.add('is-invalid');
                errorDiv.style.display = 'block';
            }
        });
    });
</script>

<style>
    .invalid-feedback {
        display: none;
        color: red;
        margin-top: 0.25rem;
    }

    input.is-invalid {
        border-color: red;
    }

    input.is-invalid:focus {
        border-color: red;
        box-shadow: 0 0 0 0.2rem rgba(255, 0, 0, 0.25);
    }

    .room-status-alert {
        background-color: #ffe5e5;
        color: #ff4444;
        padding: 12px 20px;
        border-radius: 8px;
        margin: 10px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: bold;
        width: 100%;
        justify-content: center;
    }

    .room-status-alert i {
        font-size: 20px;
    }

    .payment-methods {
        margin-top: 10px;
    }

    .payment-methods .form-check {
        margin-bottom: 10px;
        padding: 10px;
    }
</style>